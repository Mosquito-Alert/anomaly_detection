# Generated by Django 5.2 on 2025-05-13 14:42

import django.db.models.deletion
import django.db.models.expressions
import uuid
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('geo', '0001_initial'),
    ]

    operations = [
        migrations.CreateModel(
            name='MetricExecution',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('date', models.DateField(help_text='The date of the execution.', unique=True, verbose_name='Date')),
                ('success_percentage', models.FloatField(help_text='The percentage of success of the execution.', verbose_name='Success percentage')),
            ],
            options={
                'verbose_name': 'Metric Execution',
                'verbose_name_plural': 'Metric Executions',
                'ordering': ['date'],
                'indexes': [models.Index(fields=['-date'], name='predictions_date_f6ae64_idx')],
            },
        ),
        migrations.CreateModel(
            name='Metric',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('date', models.DateField(help_text='The date of the metric.', verbose_name='Date')),
                ('value', models.FloatField(help_text='The actual value of the metric.', verbose_name='Value')),
                ('predicted_value', models.FloatField(blank=True, help_text='The predicted value of the metric. This value will be estimated at creation.', null=True, verbose_name='Predicted value')),
                ('lower_value', models.FloatField(blank=True, help_text='The predicted lower band value of the metric, from which values will be             considerated as anomalies. This value will be estimated at creation.', null=True, verbose_name='Lower value')),
                ('upper_value', models.FloatField(blank=True, help_text='The predicted upper band value of the metric, from which values will be             considerated as anomalies. This value will be estimated at creation.', null=True, verbose_name='Lower value')),
                ('trend', models.FloatField(blank=True, help_text='The predicted serial tendency for the metric. This value will be estimated at creation.', null=True, verbose_name='Trend')),
                ('anomaly_degree', models.GeneratedField(db_persist=True, expression=models.Case(models.When(then=django.db.models.expressions.CombinedExpression(django.db.models.expressions.CombinedExpression(models.F('value'), '-', models.F('upper_value')), '/', models.F('value')), value__gt=models.F('upper_value')), models.When(then=django.db.models.expressions.CombinedExpression(django.db.models.expressions.CombinedExpression(models.F('value'), '-', models.F('lower_value')), '/', models.F('value')), value__lt=models.F('lower_value')), default=models.Value(0.0), output_field=models.FloatField()), help_text='The degree of the anomaly, a range of values that starts on -1 (a lower anomaly of the             highest degree) and ends on +1 (a upper anomaly of the highest degree). The 0 value means that             these is no anomaly. This value will be estimated at creation.', null=True, output_field=models.FloatField(), verbose_name='Anomaly degree')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('region', models.ForeignKey(help_text='The region associated to the metric.', on_delete=django.db.models.deletion.CASCADE, related_name='metrics', to='geo.municipality', verbose_name='Region')),
            ],
            options={
                'verbose_name': 'Metric',
                'verbose_name_plural': 'Metrics',
                'ordering': ['region', '-date'],
                'indexes': [models.Index(fields=['date'], name='predictions_date_6dc93c_idx'), models.Index(fields=['region', 'date'], name='predictions_region__c7e563_idx')],
                'constraints': [models.UniqueConstraint(fields=('region', 'date'), name='unique_metric')],
            },
        ),
        migrations.CreateModel(
            name='MetricSeasonality',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('index', models.SmallIntegerField(blank=True, help_text='The index position of the seasonality for a list of the days of a year. This translates to             the day number minus 1; values from 0 to 364 (or 365 for the leap years).', null=True, verbose_name='Index')),
                ('yearly_value', models.FloatField(blank=True, help_text='The value of the seasonality prediction for a certain day.', null=True, verbose_name='Yearly value')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('region', models.ForeignKey(help_text='The region associated to the seasonality.', on_delete=django.db.models.deletion.CASCADE, related_name='seasonalities', to='geo.municipality', verbose_name='Region')),
            ],
            options={
                'verbose_name': 'Seasonality for metric',
                'verbose_name_plural': 'Seasonalities for metric',
                'ordering': ['region', 'index'],
                'indexes': [models.Index(fields=['index'], name='predictions_index_80d05c_idx')],
                'constraints': [models.UniqueConstraint(fields=('region', 'index'), name='unique_region_seasonality')],
            },
        ),
    ]
