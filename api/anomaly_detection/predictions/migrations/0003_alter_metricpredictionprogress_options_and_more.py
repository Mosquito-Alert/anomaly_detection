# Generated by Django 5.2 on 2025-05-26 08:46

import django.db.models.expressions
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('predictions', '0002_alter_metric_predictor_alter_metric_value'),
    ]

    operations = [
        migrations.AlterModelOptions(
            name='metricpredictionprogress',
            options={'ordering': ['date'], 'verbose_name': 'Metric Prediction Progress',
                     'verbose_name_plural': 'Metric Prediction Progressses'},
        ),
        migrations.RemoveField(
            model_name="metric",
            name="anomaly_degree",
        ),
        migrations.AddField(
            model_name='metric',
            name='anomaly_degree',
            field=models.GeneratedField(db_persist=True, expression=models.Case(models.When(predicted_value__isnull=True, then=models.Value(None)), default=models.Case(models.When(then=models.Case(models.When(then=models.Value(1.0), upper_value__lt=0), models.When(lower_value__gt=0, then=models.Value(-1.0)), default=models.Value(0.0), output_field=models.FloatField()), value=0), models.When(then=django.db.models.expressions.CombinedExpression(django.db.models.expressions.CombinedExpression(models.F('value'), '-', models.F('upper_value')), '/', models.F('value')), value__gt=models.F('upper_value')), models.When(
                then=django.db.models.expressions.CombinedExpression(django.db.models.expressions.CombinedExpression(models.F('value'), '-', models.F('lower_value')), '/', models.F('value')), value__lt=models.F('lower_value')), default=models.Value(0.0), output_field=models.FloatField())), help_text='The degree of the anomaly, a range of values that starts on -1 (a lower anomaly of the             highest degree) and ends on +1 (a upper anomaly of the highest degree). The 0 value means that             these is no anomaly. This value will be estimated at creation.', null=True, output_field=models.FloatField(), verbose_name='Anomaly degree'),
        ),
    ]
